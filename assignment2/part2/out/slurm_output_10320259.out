Running experiment on cifar10 with random_patch and prompt size 30
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=12, epochs=20, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=30, text_prompt_template='This is a photo of a {}', visualize_prompt=True, root='/scratch/lcur0640', dataset='cifar10', image_size=224, test_noise=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_30_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume=None, evaluate=False, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_30_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Downloading https://www.cs.toronto.edu/~kriz/cifar-10-python.tar.gz to /scratch/lcur0640/cifar-10-python.tar.gz
  0%|          | 0/170498071 [00:00<?, ?it/s]  0%|          | 65536/170498071 [00:00<08:18, 341645.31it/s]  0%|          | 131072/170498071 [00:00<06:08, 462509.31it/s]  0%|          | 196608/170498071 [00:00<05:20, 531913.07it/s]  0%|          | 294912/170498071 [00:00<04:08, 686240.62it/s]  0%|          | 458752/170498071 [00:00<02:50, 1000112.75it/s]  0%|          | 819200/170498071 [00:00<01:32, 1833230.26it/s]  1%|          | 1474560/170498071 [00:00<00:51, 3282432.70it/s]  1%|▏         | 2326528/170498071 [00:00<00:34, 4843464.07it/s]  2%|▏         | 3145728/170498071 [00:01<00:28, 5844765.89it/s]  2%|▏         | 3997696/170498071 [00:01<00:25, 6587775.39it/s]  3%|▎         | 4849664/170498071 [00:01<00:23, 7117296.73it/s]  3%|▎         | 5668864/170498071 [00:01<00:22, 7422360.07it/s]  4%|▍         | 6520832/170498071 [00:01<00:21, 7662183.53it/s]  4%|▍         | 7372800/170498071 [00:01<00:20, 7831796.42it/s]  5%|▍         | 8224768/170498071 [00:01<00:20, 7946616.63it/s]  5%|▌         | 9076736/170498071 [00:01<00:20, 8033452.03it/s]  6%|▌         | 9928704/170498071 [00:01<00:19, 8088096.03it/s]  6%|▋         | 10747904/170498071 [00:01<00:19, 8077104.78it/s]  7%|▋         | 11599872/170498071 [00:02<00:19, 8099890.29it/s]  7%|▋         | 12451840/170498071 [00:02<00:19, 8151811.25it/s]  8%|▊         | 13303808/170498071 [00:02<00:19, 8164919.67it/s]  8%|▊         | 14155776/170498071 [00:02<00:19, 8213563.52it/s]  9%|▉         | 15007744/170498071 [00:02<00:19, 8166026.25it/s]  9%|▉         | 15859712/170498071 [00:02<00:18, 8207055.52it/s] 10%|▉         | 16711680/170498071 [00:02<00:18, 8199663.70it/s] 10%|█         | 17563648/170498071 [00:02<00:18, 8216345.10it/s] 11%|█         | 18415616/170498071 [00:02<00:18, 8214780.25it/s] 11%|█▏        | 19267584/170498071 [00:02<00:18, 8145659.89it/s] 12%|█▏        | 20086784/170498071 [00:03<00:18, 7998153.97it/s] 12%|█▏        | 20905984/170498071 [00:03<00:19, 7867880.94it/s] 13%|█▎        | 21725184/170498071 [00:03<00:19, 7815939.95it/s] 13%|█▎        | 22511616/170498071 [00:03<00:19, 7760326.34it/s] 14%|█▎        | 23363584/170498071 [00:03<00:18, 7902100.02it/s] 14%|█▍        | 24281088/170498071 [00:03<00:17, 8192938.32it/s] 15%|█▍        | 25133056/170498071 [00:03<00:17, 8216040.56it/s] 15%|█▌        | 25985024/170498071 [00:03<00:17, 8221070.04it/s] 16%|█▌        | 26836992/170498071 [00:03<00:17, 8262520.81it/s] 16%|█▌        | 27688960/170498071 [00:04<00:17, 8223296.02it/s] 17%|█▋        | 28540928/170498071 [00:04<00:17, 8220496.77it/s] 17%|█▋        | 29392896/170498071 [00:04<00:17, 8216010.30it/s] 18%|█▊        | 30244864/170498071 [00:04<00:17, 8188031.61it/s] 18%|█▊        | 31096832/170498071 [00:04<00:16, 8230462.98it/s] 19%|█▊        | 31948800/170498071 [00:04<00:16, 8223361.80it/s] 19%|█▉        | 32800768/170498071 [00:04<00:16, 8234958.89it/s] 20%|█▉        | 33652736/170498071 [00:04<00:16, 8240599.16it/s] 20%|██        | 34504704/170498071 [00:04<00:16, 8235950.31it/s] 21%|██        | 35422208/170498071 [00:04<00:16, 8441453.56it/s] 21%|██▏       | 36339712/170498071 [00:05<00:15, 8561542.23it/s] 22%|██▏       | 37257216/170498071 [00:05<00:15, 8677917.05it/s] 22%|██▏       | 38141952/170498071 [00:05<00:15, 8719579.36it/s] 23%|██▎       | 39059456/170498071 [00:05<00:15, 8753051.75it/s] 23%|██▎       | 39976960/170498071 [00:05<00:14, 8805484.45it/s] 24%|██▍       | 40927232/170498071 [00:05<00:14, 8962209.66it/s] 25%|██▍       | 41910272/170498071 [00:05<00:14, 9159931.94it/s] 25%|██▌       | 42860544/170498071 [00:05<00:13, 9250632.31it/s] 26%|██▌       | 43843584/170498071 [00:05<00:13, 9383332.01it/s] 26%|██▋       | 44826624/170498071 [00:05<00:13, 9432835.62it/s] 27%|██▋       | 45809664/170498071 [00:06<00:13, 9478964.54it/s] 27%|██▋       | 46792704/170498071 [00:06<00:12, 9522427.20it/s] 28%|██▊       | 47775744/170498071 [00:06<00:12, 9603705.02it/s] 29%|██▊       | 48758784/170498071 [00:06<00:12, 9547646.71it/s] 29%|██▉       | 49741824/170498071 [00:06<00:12, 9558153.06it/s] 30%|██▉       | 50724864/170498071 [00:06<00:12, 9589521.08it/s] 30%|███       | 51707904/170498071 [00:06<00:12, 9587477.72it/s] 31%|███       | 52690944/170498071 [00:06<00:12, 9571959.42it/s] 31%|███▏      | 53673984/170498071 [00:06<00:12, 9637577.41it/s] 32%|███▏      | 54657024/170498071 [00:06<00:12, 9596693.01it/s] 33%|███▎      | 55640064/170498071 [00:07<00:11, 9577016.24it/s] 33%|███▎      | 56623104/170498071 [00:07<00:11, 9622661.75it/s] 34%|███▍      | 57606144/170498071 [00:07<00:11, 9577912.78it/s] 34%|███▍      | 58589184/170498071 [00:07<00:11, 9604664.30it/s] 35%|███▍      | 59572224/170498071 [00:07<00:11, 9633029.45it/s] 36%|███▌      | 60555264/170498071 [00:07<00:11, 9582593.16it/s] 36%|███▌      | 61538304/170498071 [00:07<00:11, 9585112.18it/s] 37%|███▋      | 62521344/170498071 [00:07<00:11, 9634701.35it/s] 37%|███▋      | 63504384/170498071 [00:07<00:11, 9574913.32it/s] 38%|███▊      | 64487424/170498071 [00:08<00:11, 9422435.52it/s] 38%|███▊      | 65437696/170498071 [00:08<00:11, 9278475.73it/s] 39%|███▉      | 66387968/170498071 [00:08<00:11, 9138445.41it/s] 39%|███▉      | 67305472/170498071 [00:08<00:11, 9052593.74it/s] 40%|████      | 68222976/170498071 [00:08<00:11, 9013998.84it/s] 41%|████      | 69140480/170498071 [00:08<00:11, 8959832.40it/s] 41%|████      | 70057984/170498071 [00:08<00:11, 8920108.01it/s] 42%|████▏     | 70975488/170498071 [00:08<00:11, 8951910.38it/s] 42%|████▏     | 71892992/170498071 [00:08<00:11, 8880033.84it/s] 43%|████▎     | 72810496/170498071 [00:08<00:10, 8884763.91it/s] 43%|████▎     | 73728000/170498071 [00:09<00:10, 8850940.21it/s] 44%|████▍     | 74645504/170498071 [00:09<00:10, 8835882.77it/s] 44%|████▍     | 75530240/170498071 [00:09<00:10, 8824160.60it/s] 45%|████▍     | 76414976/170498071 [00:09<00:10, 8784228.69it/s] 45%|████▌     | 77299712/170498071 [00:09<00:10, 8790812.35it/s] 46%|████▌     | 78184448/170498071 [00:09<00:10, 8793539.03it/s] 46%|████▋     | 79069184/170498071 [00:09<00:10, 8718709.74it/s] 47%|████▋     | 79953920/170498071 [00:09<00:10, 8547449.30it/s] 47%|████▋     | 80838656/170498071 [00:09<00:10, 8421131.29it/s] 48%|████▊     | 81690624/170498071 [00:10<00:10, 8352940.87it/s] 48%|████▊     | 82542592/170498071 [00:10<00:10, 8185592.90it/s] 49%|████▉     | 83394560/170498071 [00:10<00:10, 8120482.37it/s] 49%|████▉     | 84213760/170498071 [00:10<00:10, 8139574.03it/s] 50%|████▉     | 85032960/170498071 [00:10<00:10, 8139460.80it/s] 50%|█████     | 85884928/170498071 [00:10<00:10, 8148872.38it/s] 51%|█████     | 86736896/170498071 [00:10<00:10, 8197844.99it/s] 51%|█████▏    | 87588864/170498071 [00:10<00:10, 8220155.72it/s] 52%|█████▏    | 88440832/170498071 [00:10<00:09, 8277305.34it/s] 52%|█████▏    | 89292800/170498071 [00:10<00:09, 8290081.63it/s] 53%|█████▎    | 90144768/170498071 [00:11<00:09, 8328410.66it/s] 53%|█████▎    | 90996736/170498071 [00:11<00:09, 8312852.31it/s] 54%|█████▍    | 91848704/170498071 [00:11<00:09, 8287495.34it/s] 54%|█████▍    | 92733440/170498071 [00:11<00:09, 8354609.16it/s] 55%|█████▍    | 93585408/170498071 [00:11<00:09, 8315112.46it/s] 55%|█████▌    | 94437376/170498071 [00:11<00:09, 8257623.65it/s] 56%|█████▌    | 95289344/170498071 [00:11<00:09, 8240073.11it/s] 56%|█████▋    | 96141312/170498071 [00:11<00:09, 8183042.21it/s] 57%|█████▋    | 96960512/170498071 [00:11<00:09, 8081532.74it/s] 57%|█████▋    | 97779712/170498071 [00:11<00:09, 8029184.88it/s] 58%|█████▊    | 98598912/170498071 [00:12<00:09, 7948183.44it/s] 58%|█████▊    | 99418112/170498071 [00:12<00:09, 7844650.54it/s] 59%|█████▉    | 100204544/170498071 [00:12<00:08, 7834163.86it/s] 59%|█████▉    | 100990976/170498071 [00:12<00:08, 7801731.43it/s] 60%|█████▉    | 101777408/170498071 [00:12<00:08, 7792927.41it/s] 60%|██████    | 102629376/170498071 [00:12<00:08, 7926040.36it/s] 61%|██████    | 103677952/170498071 [00:12<00:07, 8647688.86it/s] 61%|██████▏   | 104792064/170498071 [00:12<00:07, 9333610.27it/s] 62%|██████▏   | 105971712/170498071 [00:12<00:06, 10021232.19it/s] 63%|██████▎   | 107184128/170498071 [00:12<00:05, 10634702.33it/s] 64%|██████▎   | 108429312/170498071 [00:13<00:05, 11121066.56it/s] 64%|██████▍   | 109740032/170498071 [00:13<00:05, 11670325.03it/s] 65%|██████▌   | 110919680/170498071 [00:13<00:05, 11678342.59it/s] 66%|██████▌   | 112099328/170498071 [00:13<00:05, 11479205.26it/s] 66%|██████▋   | 113278976/170498071 [00:13<00:05, 11441912.69it/s] 67%|██████▋   | 114622464/170498071 [00:13<00:04, 12020393.07it/s] 68%|██████▊   | 116064256/170498071 [00:13<00:04, 12640171.64it/s] 69%|██████▉   | 117506048/170498071 [00:13<00:04, 13148368.18it/s] 70%|██████▉   | 119013376/170498071 [00:13<00:03, 13642493.92it/s] 71%|███████   | 120586240/170498071 [00:14<00:03, 14239572.17it/s] 72%|███████▏  | 122257408/170498071 [00:14<00:03, 14954298.40it/s] 73%|███████▎  | 123994112/170498071 [00:14<00:02, 15647383.72it/s] 74%|███████▍  | 125796352/170498071 [00:14<00:02, 16309536.85it/s] 75%|███████▍  | 127598592/170498071 [00:14<00:02, 16810919.91it/s] 76%|███████▌  | 129564672/170498071 [00:14<00:02, 17638325.96it/s] 77%|███████▋  | 131596288/170498071 [00:14<00:02, 18393279.49it/s] 78%|███████▊  | 133726208/170498071 [00:14<00:01, 19221110.27it/s] 80%|███████▉  | 135987200/170498071 [00:14<00:01, 20189920.18it/s] 81%|████████  | 138379264/170498071 [00:14<00:01, 21187979.51it/s] 83%|████████▎ | 140836864/170498071 [00:15<00:01, 22193999.02it/s] 84%|████████▍ | 143458304/170498071 [00:15<00:01, 23258338.57it/s] 86%|████████▌ | 146145280/170498071 [00:15<00:01, 24300748.21it/s] 87%|████████▋ | 148865024/170498071 [00:15<00:00, 25092633.72it/s] 89%|████████▉ | 151650304/170498071 [00:15<00:00, 25882781.59it/s] 91%|█████████ | 154304512/170498071 [00:15<00:00, 25959841.54it/s] 92%|█████████▏| 157024256/170498071 [00:15<00:00, 26317171.62it/s] 94%|█████████▍| 159973376/170498071 [00:15<00:00, 27195916.18it/s] 95%|█████████▌| 162758656/170498071 [00:15<00:00, 27391671.38it/s] 97%|█████████▋| 165511168/170498071 [00:15<00:00, 27243246.33it/s] 99%|█████████▊| 168296448/170498071 [00:16<00:00, 27389094.71it/s]100%|██████████| 170498071/170498071 [00:16<00:00, 10579469.63it/s]
/home/lcur0640/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 12 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Extracting /scratch/lcur0640/cifar-10-python.tar.gz to /scratch/lcur0640
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
  0%|                                               | 0.00/338M [00:00<?, ?iB/s]  2%|▋                                     | 6.62M/338M [00:00<00:05, 67.4MiB/s]  4%|█▍                                    | 13.1M/338M [00:00<00:05, 67.4MiB/s]  7%|██▌                                   | 22.3M/338M [00:00<00:04, 80.3MiB/s]  9%|███▌                                  | 31.3M/338M [00:00<00:03, 85.8MiB/s] 12%|████▋                                 | 41.6M/338M [00:00<00:03, 93.9MiB/s] 15%|█████▋                                | 50.6M/338M [00:00<00:03, 92.3MiB/s] 18%|██████▋                               | 59.4M/338M [00:00<00:03, 91.1MiB/s] 21%|████████▏                              | 70.9M/338M [00:00<00:02, 100MiB/s] 24%|█████████                             | 80.5M/338M [00:00<00:02, 98.6MiB/s] 27%|██████████                            | 89.9M/338M [00:01<00:02, 98.4MiB/s] 29%|███████████▏                          | 99.3M/338M [00:01<00:02, 88.4MiB/s] 32%|████████████▌                          | 109M/338M [00:01<00:02, 92.7MiB/s] 35%|█████████████▋                         | 118M/338M [00:01<00:02, 92.7MiB/s] 38%|██████████████▋                        | 127M/338M [00:01<00:02, 89.9MiB/s] 40%|███████████████▋                       | 136M/338M [00:01<00:02, 87.8MiB/s] 43%|████████████████▋                      | 144M/338M [00:01<00:02, 87.4MiB/s] 45%|█████████████████▋                     | 153M/338M [00:01<00:02, 85.6MiB/s] 48%|██████████████████▋                    | 162M/338M [00:01<00:02, 87.7MiB/s] 51%|███████████████████▊                   | 171M/338M [00:01<00:01, 91.7MiB/s] 54%|████████████████████▉                  | 181M/338M [00:02<00:01, 94.2MiB/s] 56%|█████████████████████▉                 | 190M/338M [00:02<00:01, 94.5MiB/s] 59%|██████████████████████▉                | 199M/338M [00:02<00:01, 93.0MiB/s] 62%|████████████████████████               | 208M/338M [00:02<00:01, 92.0MiB/s] 64%|█████████████████████████              | 217M/338M [00:02<00:01, 90.4MiB/s] 67%|██████████████████████████             | 225M/338M [00:02<00:01, 64.9MiB/s] 70%|███████████████████████████▏           | 236M/338M [00:02<00:01, 75.0MiB/s] 73%|████████████████████████████▎          | 245M/338M [00:02<00:01, 79.5MiB/s] 75%|█████████████████████████████▎         | 253M/338M [00:03<00:01, 81.9MiB/s] 78%|██████████████████████████████▎        | 262M/338M [00:03<00:01, 72.1MiB/s] 81%|███████████████████████████████▍       | 272M/338M [00:03<00:00, 80.4MiB/s] 83%|████████████████████████████████▍      | 280M/338M [00:03<00:00, 77.2MiB/s] 86%|█████████████████████████████████▍     | 289M/338M [00:03<00:00, 81.0MiB/s] 88%|██████████████████████████████████▎    | 297M/338M [00:03<00:00, 81.3MiB/s] 91%|███████████████████████████████████▎   | 306M/338M [00:03<00:00, 84.2MiB/s] 94%|████████████████████████████████████▍  | 316M/338M [00:03<00:00, 89.9MiB/s] 97%|█████████████████████████████████████▊ | 327M/338M [00:03<00:00, 98.6MiB/s]100%|██████████████████████████████████████▉| 337M/338M [00:04<00:00, 91.8MiB/s]100%|███████████████████████████████████████| 338M/338M [00:04<00:00, 86.9MiB/s]
List of prompts:
['This is a photo of a airplane',
 'This is a photo of a automobile',
 'This is a photo of a bird',
 'This is a photo of a cat',
 'This is a photo of a deer',
 'This is a photo of a dog',
 'This is a photo of a frog',
 'This is a photo of a horse',
 'This is a photo of a ship',
 'This is a photo of a truck']
Visualizing prompt...
Turning off gradients in both the image and the text encoder
Parameters to be updated:
"Parameters to be updated: {'prompt_learner.patch'}"
Number of prompt parameters:  2700
  0%|          | 0/313 [00:00<?, ?it/s]/home/lcur0640/.conda/envs/dl2022/lib/python3.10/site-packages/torch/autograd/__init__.py:197: UserWarning: Error detected in NormBackward1. No forward pass information available. Enable detect anomaly during forward pass for more information. (Triggered internally at /opt/conda/conda-bld/pytorch_1666642969563/work/torch/csrc/autograd/python_anomaly_mode.cpp:92.)
  Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
  0%|          | 0/313 [00:05<?, ?it/s]
Traceback (most recent call last):
  File "/home/lcur0640/repos/DeepLearning1_UvA_22/assignment2/part2/.//main.py", line 150, in <module>
    main()
  File "/home/lcur0640/repos/DeepLearning1_UvA_22/assignment2/part2/.//main.py", line 144, in main
    learn.run()
  File "/home/lcur0640/repos/DeepLearning1_UvA_22/assignment2/part2/learner.py", line 149, in run
    self.train_one_epoch(epoch)
  File "/home/lcur0640/repos/DeepLearning1_UvA_22/assignment2/part2/learner.py", line 235, in train_one_epoch
    loss.backward(retain_graph=True)
  File "/home/lcur0640/.conda/envs/dl2022/lib/python3.10/site-packages/torch/_tensor.py", line 487, in backward
    torch.autograd.backward(
  File "/home/lcur0640/.conda/envs/dl2022/lib/python3.10/site-packages/torch/autograd/__init__.py", line 197, in backward
    Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
RuntimeError: one of the variables needed for gradient computation has been modified by an inplace operation: [torch.cuda.HalfTensor [128, 512]], which is output 0 of DivBackward0, is at version 1; expected version 0 instead. Hint: the backtrace further above shows the operation that failed to compute its gradient. The variable in question was changed in there or anywhere later. Good luck!
